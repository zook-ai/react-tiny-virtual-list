!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):e.VirtualList=t(e.React,e.PropTypes)}(this,function(e,t){"use strict";var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};var i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};var n,r,s,a,l="start",f="center",d="vertical",u="horizontal",c="observed",h="requested",p=((n={})[d]="scrollTop",n[u]="scrollLeft",n),m=((r={})[d]="height",r[u]="width",r),g=((s={})[d]="top",s[u]="left",s),v=((a={})[d]="translateY",a[u]="translateX",a),y=function(){function e(e){var t=e.itemCount,o=e.itemSizeGetter,i=e.estimatedItemSize;this.itemSizeGetter=o,this.itemCount=t,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return e.prototype.updateConfig=function(e){var t=e.itemCount,o=e.estimatedItemSize;this.itemCount=t,this.estimatedItemSize=o},e.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},e.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),o=t.offset+t.size,i=this.lastMeasuredIndex+1;i<=e;i++){var n=this.itemSizeGetter(i);if(null==n||isNaN(n))throw Error("Invalid size returned for index "+i+" of value "+n);this.itemSizeAndPositionData[i]={offset:o,size:n},o+=n}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},e.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},e.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},e.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,o=void 0===t?l:t,i=e.containerSize,n=e.currentOffset,r=e.targetIndex;if(i<=0)return 0;var s,a=this.getSizeAndPositionForIndex(r),d=a.offset,u=d-i+a.size;switch(o){case"end":s=u;break;case f:s=d-(i-a.size)/2;break;case l:s=d;break;default:s=Math.max(u,Math.min(d,n))}var c=this.getTotalSize();return Math.max(0,Math.min(c-i,s))},e.prototype.getVisibleRange=function(e){var t=e.containerSize,o=e.offset,i=e.overscanCount;if(0===this.getTotalSize())return{};var n=o+t,r=this.findNearestItem(o);if(void 0===r)throw Error("Invalid offset "+o+" specified");var s=this.getSizeAndPositionForIndex(r);o=s.offset+s.size;for(var a=r;o<n&&a<this.itemCount-1;)a++,o+=this.getSizeAndPositionForIndex(a).size;return i&&(r=Math.max(0,r-i),a=Math.min(a+i,this.itemCount-1)),{start:r,stop:a}},e.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},e.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),o=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:o,low:0,offset:e}):this.exponentialSearch({index:o,offset:e})},e.prototype.binarySearch=function(e){for(var t=e.low,o=e.high,i=e.offset,n=0,r=0;t<=o;){if(n=t+Math.floor((o-t)/2),(r=this.getSizeAndPositionForIndex(n).offset)===i)return n;r<i?t=n+1:r>i&&(o=n-1)}return t>0?t-1:0},e.prototype.exponentialSearch=function(e){for(var t=e.index,o=e.offset,i=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<o;)t+=i,i*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:o})},e}(),I={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},S={position:"relative",overflow:"hidden",width:"100%",minHeight:"100%"},z={position:"absolute",left:0,width:"100%"};return function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.sizeAndPositionManager=new y({itemCount:e.props.itemCount,itemSizeGetter:function(t){return e.getSize(t)},estimatedItemSize:e.getEstimatedItemSize()}),e.state={offset:e.props.scrollOffset||null!=e.props.scrollToIndex&&e.getOffsetForIndex(e.props.scrollToIndex)||0,scrollChangeReason:h},e.styleCache={},e.handleScroll=function(t){var o=e.props.onScroll,i=e.getNodeOffset();i<0||e.state.offset===i||t.target!==e.rootNode||(e.setState({offset:i,scrollChangeReason:c}),"function"==typeof o&&o(i,t))},e.getRootNodeRef=function(t){e.rootNode=t},e.getInnerNodeRef=function(t){e.innerNode=t},e}return function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(r,n),r.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,o=e.scrollToIndex;null!=t?this.scrollTo(t,!0):null!=o&&this.scrollTo(this.getOffsetForIndex(o),!0)},r.prototype.componentWillReceiveProps=function(e){var t=this.props,o=t.estimatedItemSize,i=t.itemCount,n=t.itemSize,r=t.scrollOffset,s=t.scrollToAlignment,a=t.scrollToIndex,l=e.scrollToIndex!==a||e.scrollToAlignment!==s,f=e.itemCount!==i||e.itemSize!==n||e.estimatedItemSize!==o;e.itemCount===i&&e.estimatedItemSize===o||this.sizeAndPositionManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),f&&this.recomputeSizes(),e.scrollOffset!==r?this.setState({offset:e.scrollOffset||0,scrollChangeReason:h}):"number"==typeof e.scrollToIndex&&(l||f)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:h})},r.prototype.componentDidUpdate=function(e,t){var o=this.state,i=o.offset,n=o.scrollChangeReason;t.offset!==i&&n===h&&this.scrollTo(i)},r.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},r.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,t=void 0===e?d:e;return this.rootNode[p[t]]},r.prototype.scrollTo=function(e,t){var o=this;void 0===t&&(t=!1);var i=this.props.scrollDirection,n=void 0===i?d:i,r=this.innerNode.getBoundingClientRect();if(this.rootNode[p[n]]=e,!t&&void 0!==this.props.scrollToTransition&&""===this.innerNode.style.transition){var s=this.innerNode.getBoundingClientRect(),a=r[g[n]]-s[g[n]];this.innerNode.style.transform=v[n]+"("+a+"px)",requestAnimationFrame(function(){o.innerNode.style.transition=o.props.scrollToTransition||"",o.innerNode.style.transitionProperty="transform",o.innerNode.style.transform=""});var l=function(){o.innerNode.style.transition="",o.innerNode.style.transitionProperty="",o.innerNode.removeEventListener("transitionend",l)};this.innerNode.addEventListener("transitionend",l)}},r.prototype.getOffsetForIndex=function(e,t,o){void 0===t&&(t=this.props.scrollToAlignment),void 0===o&&(o=this.props.itemCount);var i=this.props.scrollDirection,n=void 0===i?d:i;return(e<0||e>=o)&&(e=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:t,containerSize:this.props[m[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},r.prototype.getSize=function(e){var t=this.props.itemSize;return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},r.prototype.getStyle=function(e){var t=this.styleCache[e];if(t)return t;var o,n=this.props.scrollDirection,r=void 0===n?d:n,s=this.sizeAndPositionManager.getSizeAndPositionForIndex(e),a=s.size,l=s.offset;return this.styleCache[e]=i({},z,((o={})[m[r]]=a,o[g[r]]=l,o))},r.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.sizeAndPositionManager.resetItem(e)},r.prototype.render=function(){var t,o=this.props,n=(o.estimatedItemSize,o.height),r=o.overscanCount,s=void 0===r?3:r,a=o.renderItem,l=(o.itemCount,o.itemSize,o.onItemsRendered),f=(o.onScroll,o.scrollDirection),u=void 0===f?d:f,c=o.scrollToTransition,h=(o.scrollOffset,o.scrollToIndex,o.scrollToAlignment,o.style),p=o.width,g=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&(o[i[n]]=e[i[n]])}return o}(o,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollToTransition","scrollOffset","scrollToIndex","scrollToAlignment","style","width"]),v=this.state.offset,y=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[m[u]]||0,offset:v,overscanCount:s}),z=y.start,x=y.stop,C=[];if(void 0!==z&&void 0!==x){for(var O=z;O<=x;O++)C.push(a({index:O,style:this.getStyle(O)}));"function"==typeof l&&l({startIndex:z,stopIndex:x})}return e.createElement("div",i({ref:this.getRootNodeRef},g,{onScroll:this.handleScroll,style:i({},I,h,{height:n,width:p})}),e.createElement("div",{ref:this.getInnerNodeRef,style:i({},S,(t={willChange:void 0!==c?"transform":null},t[m[u]]=this.sizeAndPositionManager.getTotalSize(),t))},C))},r.defaultProps={overscanCount:3,scrollDirection:d,width:"100%"},r.propTypes={estimatedItemSize:t.number,height:t.oneOfType([t.number,t.string]).isRequired,itemCount:t.number.isRequired,itemSize:t.oneOfType([t.number,t.array,t.func]).isRequired,onItemsRendered:t.func,overscanCount:t.number,renderItem:t.func.isRequired,scrollOffset:t.number,scrollToIndex:t.number,scrollToAlignment:t.oneOf(["auto",l,f,"end"]),scrollToTransition:t.string,scrollDirection:t.oneOf([u,d]).isRequired,width:t.oneOfType([t.number,t.string]).isRequired},r}(e.PureComponent)});
